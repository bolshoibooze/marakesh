(function(a){a.fn.formset=function(b){var l=a.extend({},a.fn.formset.defaults,b);var g=a(this);var d=g.parent();var k=function(p,r,n){var m=new RegExp("("+r+"-(\\d+|__prefix__))");var o=r+"-"+n;var s=a(p);if(s.attr("for")){a(p).attr("for",a(p).attr("for").replace(m,o))}if(p.id){p.id=p.id.replace(m,o)}if(p.name){p.name=p.name.replace(m,o)}var q=s.find(".modal");if(q.length){q.attr("id","modal-wrapper-"+o);s.find(".inline-modal").attr("href","#modal-wrapper-"+o)}};var e=a("#id_"+l.prefix+"-TOTAL_FORMS").attr("autocomplete","off");var f=parseInt(e.val(),10);var i=a("#id_"+l.prefix+"-MAX_NUM_FORMS").attr("autocomplete","off");var j=i.val()===""||(i.val()-e.val())>0;g.each(function(m){a(this).not("."+l.emptyCssClass).addClass(l.formCssClass)});if(g.length&&j){var h;if(g.prop("tagName")=="TR"){var c=this.eq(-1).children().length;d.append('<tr class="'+l.addCssClass+'"><td colspan="'+c+'"><i class="icon-plus admin-inline-icon"></i>&#xa0;<a href="javascript:void(0)">'+l.addText+"</a></tr>");h=d.find("tr:last a")}else{g.filter(":last").after('<div class="'+l.addCssClass+'"><i class="icon-plus  admin-inline-icon"></i>&#xa0;<a href="javascript:void(0)">'+l.addText+"</a></div>");h=g.filter(":last").next().find("a")}h.click(function(q){q.preventDefault();var p=a("#id_"+l.prefix+"-TOTAL_FORMS");var m=a("#"+l.prefix+"-empty");var r=m.clone(true);r.removeClass(l.emptyCssClass).addClass(l.formCssClass).attr("id",l.prefix+"-"+f);var n=r.find("#modal-wrapper-"+l.prefix+"-empty");if(n.length){var o="modal-wrapper-"+l.prefix+"-"+f;n.attr("id",o);r.find("a.inline-modal").attr("href","#"+o)}if(r.is("tr")){r.children(":last").append('<div><i class="admin-inline-icon icon-trash"></i>&#xa0;<a class="'+l.deleteCssClass+'" href="javascript:void(0)">'+l.deleteText+"</a></div>")}else{if(r.is("ul")||r.is("ol")){r.append('<li><a class="'+l.deleteCssClass+'" href="javascript:void(0)">'+l.deleteText+"</a></li>")}else{r.children(":first").append('<span class="inline-edit"><i class="admin-inline-icon icon-trash"></i>&#xa0;<a class="'+l.deleteCssClass+'" href="javascript:void(0)">'+l.deleteText+"</a></span>")}}r.find("*").each(function(){k(this,l.prefix,p.val())});r.insertBefore(a(m));a(p).val(parseInt(p.val(),10)+1);f+=1;if((i.val()!=="")&&(i.val()-p.val())<=0){h.parent().hide()}r.find("a."+l.deleteCssClass).click(function(v){v.preventDefault();var w=a(this).parents("."+l.formCssClass);w.remove();f-=1;if(l.removed){l.removed(w)}var s=a("."+l.formCssClass);a("#id_"+l.prefix+"-TOTAL_FORMS").val(s.length);if((i.val()==="")||(i.val()-s.length)>0){h.parent().show()}for(var t=0,u=s.length;t<u;t++){k(a(s).get(t),l.prefix,t);a(s.get(t)).find("*").each(function(){k(this,l.prefix,t)})}});if(l.added){l.added(r)}})}return this};a.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null};a.fn.tabularFormset=function(d){var c=a(this);var f=function(h){a(c.selector).not(".add-row").removeClass("row1 row2").filter(":even").addClass("row1").end().filter(":odd").addClass("row2")};var b=function(){if(typeof DateTimeShortcuts!="undefined"){a(".datetimeshortcuts").remove();DateTimeShortcuts.init()}};var e=function(){if(typeof SelectFilter!="undefined"){a(".selectfilter").each(function(h,j){var i=j.name.split("-");SelectFilter.init(j.id,i[i.length-1],false,d.adminStaticPrefix)});a(".selectfilterstacked").each(function(h,j){var i=j.name.split("-");SelectFilter.init(j.id,i[i.length-1],true,d.adminStaticPrefix)})}};var g=function(h){h.find(".prepopulated_field").each(function(){var l=a(this),j=l.find("input, select, textarea"),i=j.data("dependency_list")||[],k=[];a.each(i,function(m,n){k.push("#"+h.find(".field-"+n).find("input, select, textarea").attr("id"))});if(k.length){j.prepopulate(k,j.attr("maxlength"))}})};c.formset({prefix:d.prefix,addText:d.addText,formCssClass:"dynamic-"+d.prefix,deleteCssClass:"inline-deletelink",deleteText:d.deleteText,emptyCssClass:"empty-form",removed:f,added:function(h){g(h);b();e();f(h)}});return c};a.fn.stackedFormset=function(d){var c=a(this);var e=function(h){a(c.selector).find(".inline_label").each(function(j){var k=j+1;a(this).html(a(this).html().replace(/(#\d+)/g,"#"+k))})};var b=function(){if(typeof DateTimeShortcuts!="undefined"){a(".datetimeshortcuts").remove();DateTimeShortcuts.init()}};var f=function(){if(typeof SelectFilter!="undefined"){a(".selectfilter").each(function(h,j){var i=j.name.split("-");SelectFilter.init(j.id,i[i.length-1],false,d.adminStaticPrefix)});a(".selectfilterstacked").each(function(h,j){var i=j.name.split("-");SelectFilter.init(j.id,i[i.length-1],true,d.adminStaticPrefix)})}};var g=function(h){h.find(".prepopulated_field").each(function(){var l=a(this),j=l.find("input, select, textarea"),i=j.data("dependency_list")||[],k=[];a.each(i,function(m,n){k.push("#"+h.find(".form-row .field-"+n).find("input, select, textarea").attr("id"))});if(k.length){j.prepopulate(k,j.attr("maxlength"))}})};c.formset({prefix:d.prefix,addText:d.addText,formCssClass:"dynamic-"+d.prefix,deleteCssClass:"inline-deletelink",deleteText:d.deleteText,emptyCssClass:"empty-form",removed:e,added:(function(h){g(h);b();f();e(h)})});return c}})(yawdadmin.jQuery);